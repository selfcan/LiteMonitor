{
  "id": "weather_sojson",
  "meta": {
    "name": "è‡ªåŠ¨å¤©æ°” (SoJson)",
    "version": "1.1.0",
    "author": "System",
    "description": "åŸºäºIPå®šä½ï¼Œè·å–é«˜ç²¾åº¦å¤©æ°”æ•°æ®"
  },
  "inputs": [
    {
      "key": "city",
      "label": "åŸå¸‚åç§°",
      "type": "text",
      "default": "",
      "placeholder": "ç•™ç©ºåˆ™è‡ªåŠ¨å®šä½",
      "scope": "target"
    },
    {
      "key": "style",
      "label": "æ˜¾ç¤ºæ ¼å¼",
      "type": "select",
      "default": "standard",
      "scope": "target",
      "options": [
        { "label": "æ ‡å‡† (â˜€ï¸ æ™´ 25â„ƒ)", "value": "standard" },
        { "label": "ä»…æ¸©åº¦ (25â„ƒ)", "value": "temp_only" },
        { "label": "Emoji+æ¸©åº¦ (â˜€ï¸ 25â„ƒ)", "value": "emoji_temp" },
        { "label": "ä»…Emoji (â˜€ï¸)", "value": "emoji_only" },
        { "label": "ä»…æ–‡å­— (æ™´ 25â„ƒ)", "value": "text_temp" },
        { "label": "æ¸©å·® (20~30â„ƒ)", "value": "range" }
      ]
    }
  ],
  "execution": {
    "type": "chain",
    "interval": 1800000,
    "steps": [
      {
        "id": "step1_ip",
        "skip_if_set": "city",
        "url": "http://whois.pconline.com.cn/ipJson.jsp?json=true",
        "response_encoding": "gbk",
        "cache_minutes": 43200,
        "extract": {
          "auto_city": "city",
          "ip_province": "pro",
          "ip_district": "region"
        },
        "process": [
          {
            "var": "district_raw",
            "source": "city",
            "function": "regex_replace",
            "pattern": "^$",
            "to": "{{ip_district}}"
          },
          {
            "var": "province_raw",
            "source": "city",
            "function": "regex_replace",
            "pattern": "^$",
            "to": "{{ip_province}}"
          },
          {
            "var": "city",
            "source": "city",
            "function": "regex_replace",
            "pattern": "^$",
            "to": "{{auto_city}}"
          }
        ]
      },
      {
        "id": "step2_code",
        "url": "https://citycode.litemonitor.cn/?district={{district_raw}}&city={{city}}&province={{province_raw}}",
        "response_format": "json",
        "cache_minutes": 43200,
        "extract": {
          "city_code": "code"
        },
        "process": []
      },
      {
        "id": "step3_weather",
        "url": "http://t.weather.itboy.net/api/weather/city/{{city_code}}",
        "cache_minutes": 20,
        "extract": {
          "temp": "data.wendu",
          "type": "data.forecast[0].type",
          "high": "data.forecast[0].high",
          "low": "data.forecast[0].low"
        },
        "process": [
          {
            "var": "city_display",
            "source": "city",
            "function": "regex_replace",
            "pattern": "(å¸‚|åŒº|å¿|çœ)$",
            "to": ""
          },
          {
            "var": "weather_text",
            "source": "type",
            "function": "map",
            "map": {
              "æ™´": "â˜€ï¸ æ™´",
              "å¤šäº‘": "â›… å¤šäº‘",
              "é˜´": "â˜ï¸ é˜´",
              "å°é›¨": "ğŸŒ§ï¸ å°é›¨",
              "ä¸­é›¨": "ğŸŒ§ï¸ ä¸­é›¨",
              "å¤§é›¨": "ğŸŒ§ï¸ å¤§é›¨",
              "æš´é›¨": "ğŸŒ§ï¸ æš´é›¨",
              "é˜µé›¨": "ğŸŒ§ï¸ é˜µé›¨",
              "é›·é˜µé›¨": "â›ˆï¸ é›·é˜µé›¨",
              "é›·é˜µé›¨ä¼´æœ‰å†°é›¹": "â›ˆï¸ å†°é›¹",
              "é›¨å¤¹é›ª": "ğŸŒ§ï¸ é›¨å¤¹é›ª",
              "å°é›ª": "â„ï¸ å°é›ª",
              "ä¸­é›ª": "â„ï¸ ä¸­é›ª",
              "å¤§é›ª": "â„ï¸ å¤§é›ª",
              "æš´é›ª": "â„ï¸ æš´é›ª",
              "é˜µé›ª": "â„ï¸ é˜µé›ª",
              "é›¾": "ğŸŒ«ï¸ é›¾",
              "éœ¾": "ğŸŒ«ï¸ éœ¾",
              "æ‰¬æ²™": "ğŸŒ«ï¸ æ‰¬æ²™",
              "æµ®å°˜": "ğŸŒ«ï¸ æµ®å°˜",
              "æ²™å°˜æš´": "ğŸŒ«ï¸ æ²™å°˜æš´",
              "å¼ºæ²™å°˜æš´": "ğŸŒ«ï¸ å¼ºæ²™å°˜æš´"
            }
          },
          {
            "var": "weather_emoji",
            "source": "type",
            "function": "map",
            "map": {
              "æ™´": "â˜€ï¸",
              "å¤šäº‘": "â›…",
              "é˜´": "â˜ï¸",
              "å°é›¨": "ğŸŒ§ï¸",
              "ä¸­é›¨": "ğŸŒ§ï¸",
              "å¤§é›¨": "ğŸŒ§ï¸",
              "æš´é›¨": "ğŸŒ§ï¸",
              "é˜µé›¨": "ğŸŒ§ï¸",
              "é›·é˜µé›¨": "â›ˆï¸",
              "é›·é˜µé›¨ä¼´æœ‰å†°é›¹": "â›ˆï¸",
              "é›¨å¤¹é›ª": "ğŸŒ§ï¸",
              "å°é›ª": "â„ï¸",
              "ä¸­é›ª": "â„ï¸",
              "å¤§é›ª": "â„ï¸",
              "æš´é›ª": "â„ï¸",
              "é˜µé›ª": "â„ï¸",
              "é›¾": "ğŸŒ«ï¸",
              "éœ¾": "ğŸŒ«ï¸",
              "æ‰¬æ²™": "ğŸŒ«ï¸",
              "æµ®å°˜": "ğŸŒ«ï¸",
              "æ²™å°˜æš´": "ğŸŒ«ï¸",
              "å¼ºæ²™å°˜æš´": "ğŸŒ«ï¸"
            }
          },
          {
            "var": "high_clean",
            "source": "high",
            "function": "regex_replace",
            "pattern": "é«˜æ¸© ",
            "to": ""
          },
          {
            "var": "low_clean",
            "source": "low",
            "function": "regex_replace",
            "pattern": "ä½æ¸© ",
            "to": ""
          },
          {
            "var": "format_pattern",
            "source": "style",
            "function": "map",
            "map": {
              "standard": "{{weather_text}} {{temp}}â„ƒ",
              "temp_only": "{{temp}}â„ƒ",
              "emoji_temp": "{{weather_emoji}} {{temp}}â„ƒ",
              "emoji_only": "{{weather_emoji}}",
              "text_temp": "{{type}} {{temp}}â„ƒ",
              "range": "{{low_clean}}~{{high_clean}}"
            }
          },
          {
            "var": "final_display",
            "source": "format_pattern",
            "function": "resolve_template"
          }
        ]
      }
    ]
  },
  "outputs": [
    {
      "key": "temp",
      "label": "{{city_display ?? city ?? auto_city}}å¤©æ°”",
      "short_label": "{{city_display ?? city ?? auto_city}}",
      "format": "{{final_display}}",
      "unit": ""
    }
  ]
}